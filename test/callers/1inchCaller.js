import { wethAddress, ethAddress } from '../helpers/tokens';

const { ethers } = require('hardhat');

const { AddressZero } = ethers.constants;

const AMOUNT_ABSOLUTE = 2;
const SWAP_FIXED_INPUTS = 1;
const EMPTY_BYTES = '0x';
const EXECUTE_SIGNATURE =
  'execute(((address,uint256,uint8),(uint8,bytes)),(address,uint256),(uint8,(uint256,address),address,address,bytes))';

describe.skip('1InchCaller', () => {
  let owner;
  let Router;
  let router;
  let ilv;
  const logger = new ethers.utils.Logger('1');

  before(async () => {
    Router = await ethers.getContractFactory('Router');

    [owner] = await ethers.getSigners();

    const weth9 = await ethers.getContractAt('IWETH9', wethAddress);
    await weth9.deposit({
      value: ethers.utils.parseEther('1'),
      gasLimit: 1000000,
    });

    ilv = await ethers.getContractAt(
      'IERC20',
      '0x767FE9EDC9E0dF98E07454847909b5E959D7ca0E',
      owner,
    );
  });

  beforeEach(async () => {
    router = await Router.deploy();
  });

  it('should execute with 1inch caller', async () => {
    logger.info(
      `ilv balance is ${ethers.utils.formatUnits(await ilv.balanceOf(owner.address), 18)}`,
    );
    const tx = await router.functions[EXECUTE_SIGNATURE](
      // input
      [
        [ethAddress, ethers.utils.parseUnits('1', 18), AMOUNT_ABSOLUTE],
        ['0', EMPTY_BYTES],
      ],
      // output
      ['0x767FE9EDC9E0dF98E07454847909b5E959D7ca0E', '0'],
      // swap description
      [
        SWAP_FIXED_INPUTS,
        ['0', AddressZero],
        '0xdb38ae75c5f44276803345f7f02e95a0aeef5944',
        '0xdb38ae75c5f44276803345f7f02e95a0aeef5944',
        '0x0000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000028000000000000000000000000000000000000000000000000000000000000003e00000000000000000000000000000000000000000000000000000000000000700000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000de0b6b3a764000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000004d0e30db00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000064eb5625d9000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2000000000000000000000000d0dd7451d58318d8d528b83a8f45b0a22b7eacd10000000000000000000000000000000000000000000000000de0b6b3a764000000000000000000000000000000000000000000000000000000000000800000000000000000000000d0dd7451d58318d8d528b83a8f45b0a22b7eacd100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000a48201aa3f000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc20000000000000000000000000000000000000000000000000de0b6b3a7640000000000000000000000000000767fe9edc9e0df98e07454847909b5e959d7ca0e0000000000000000000000000000000000000000000000000000000000000001ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000002647f8fe7a000000000000000000000000000000000000000000000000000000000000000808000000000000000000000000000000000000000000000000000000000000044000000000000000000000000db38ae75c5f44276803345f7f02e95a0aeef594400000000000000000000000000000000000000000000000000000000000001e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000a405971224000000000000000000000000767fe9edc9e0df98e07454847909b5e959d7ca0e000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000100000000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004470bdb947000000000000000000000000767fe9edc9e0df98e07454847909b5e959d7ca0e00000000000000000000000000000000000000000000000138cccdfeab6bb8f50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000001a4b3af37c000000000000000000000000000000000000000000000000000000000000000808000000000000000000000000000000000000000000000000000000000000044000000000000000000000000767fe9edc9e0df98e07454847909b5e959d7ca0e000000000000000000000000000000010000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000064d1660f99000000000000000000000000767fe9edc9e0df98e07454847909b5e959d7ca0e000000000000000000000000f39fd6e51aad88f6f4ce6ab8827279cfffb9226600000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
      ],
      {
        value: ethers.utils.parseUnits('1', 18),
      },
    );
    logger.info(`Called router for ${(await tx.wait()).gasUsed} gas`);
    logger.info(
      `ilv balance is ${ethers.utils.formatUnits(await ilv.balanceOf(owner.address), 18)}`,
    );
  });
});
